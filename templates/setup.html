<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synapse Run ç³»ç»Ÿé…ç½®</title>
    <style>
        /* --- åŸºç¡€é‡ç½® --- */
        :root {
            --bg-body: #f5f7fa;
            --bg-card: #ffffff;
            --text-main: #2c3e50;
            --text-sub: #7f8c8d;
            --border-color: #eef2f7;

            /* çŠ¶æ€è‰² - è«å…°è¿ªè‰²ç³»è°ƒæ•´ */
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --bg-error-light: #fef2f2;
            --bg-success-light: #ecfdf5;
            --bg-warning-light: #fffbeb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }

        /* --- ä¸»å®¹å™¨ --- */
        .container {
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- å¤´éƒ¨ --- */
        header {
            padding: 20px 40px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .brand h1 {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
        }

        .brand p {
            font-size: 13px;
            color: var(--text-sub);
            margin-top: 2px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.ready {
            background-color: var(--bg-success-light);
            color: var(--color-success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-badge.partial {
            background-color: var(--bg-warning-light);
            color: var(--color-warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-badge.needs_config {
            background-color: var(--bg-error-light);
            color: var(--color-error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* --- ä»ªè¡¨ç›˜ç»Ÿè®¡åŒº --- */
        .dashboard-stats {
            display: flex;
            padding: 15px 40px;
            background-color: #fafbfc;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .stat-item {
            flex: 1;
            text-align: center;
            border-right: 1px solid var(--border-color);
        }

        .stat-item:last-child { border-right: none; }

        .stat-num {
            display: block;
            font-size: 28px;
            font-weight: 700;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-sub);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* é¢œè‰²åº”ç”¨ */
        .c-success { color: var(--color-success); }
        .c-warning { color: var(--color-warning); }
        .c-error { color: var(--color-error); }

        /* --- åˆ—è¡¨åŒºåŸŸ --- */
        .check-list {
            list-style: none;
            padding: 20px 40px;
            overflow-y: auto;
            flex: 1;
        }

        .list-item {
            display: flex;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .list-item:last-child { border-bottom: none; }

        /* å›¾æ ‡å®¹å™¨ */
        .icon-box {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .icon-box.success { background-color: #ecfdf5; }
        .icon-box.warning { background-color: #fffbeb; }
        .icon-box.error { background-color: #fef2f2; }

        /* SVG å›¾æ ‡æ ·å¼ */
        .icon-box svg { width: 20px; height: 20px; }
        .icon-box.success svg { stroke: var(--color-success); }
        .icon-box.warning svg { stroke: var(--color-warning); }
        .icon-box.error svg { stroke: var(--color-error); }

        .content {
            flex: 1;
        }

        .content h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
        }

        .content p {
            font-size: 13px;
            color: var(--text-sub);
        }

        .error-detail {
            margin-top: 6px;
            font-size: 12px;
            background: rgba(239, 68, 68, 0.05);
            padding: 4px 8px;
            border-radius: 4px;
            display: block;
        }

        .error-detail-item {
            color: var(--color-error);
            margin: 2px 0;
        }

        /* æŒ‰é’®æ ·å¼ */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px 40px;
            border-top: 1px solid var(--border-color);
            background-color: #fafbfc;
            flex-shrink: 0;
        }

        .action-btn {
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 500;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: opacity 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            opacity: 0.9;
        }

        .action-btn.primary {
            background-color: var(--color-error);
        }

        .action-btn.secondary {
            background-color: #6b7280;
        }

        .action-btn.success {
            background-color: var(--color-success);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--color-error);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éšè—ç±» */
        .hidden { display: none !important; }

        /* é…ç½®è¡¨å•æ ·å¼ */
        .config-section {
            padding: 20px 40px;
        }

        #configForm {
            display: flex;
            flex-direction: column;
            height: calc(90vh - 100px);
            overflow-y: auto;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1a202c;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 13px;
            color: var(--text-main);
        }

        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-error);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .test-result {
            margin-top: 10px;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 12px;
        }

        .test-result.success {
            background: var(--bg-success-light);
            color: var(--color-success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .test-result.error {
            background: var(--bg-error-light);
            color: var(--color-error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .test-result.warning {
            background: var(--bg-warning-light);
            color: var(--color-warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .alert.success {
            background: var(--bg-success-light);
            color: var(--color-success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .alert.error {
            background: var(--bg-error-light);
            color: var(--color-error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* å¥åº·æ£€æŸ¥è§†å›¾ */
        #healthCheckView {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* é…ç½®è§†å›¾ */
        #configView {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* æ•°æ®æºé€‰æ‹©è§†å›¾ */
        #dataSourceView {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow-y: auto;
        }

        /* Keepå¯¼å…¥è§†å›¾ */
        #importView {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow-y: auto;
        }

        /* Garminå¯¼å…¥è§†å›¾ */
        #garminImportView {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow-y: auto;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            body {
                height: auto;
                overflow: auto;
            }
            .container {
                height: auto;
                max-height: none;
            }
            header, .dashboard-stats, .check-list, .config-section, .action-buttons {
                padding-left: 20px;
                padding-right: 20px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            #configForm {
                height: auto;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- å¥åº·æ£€æŸ¥è§†å›¾ -->
        <div id="healthCheckView">
            <!-- é¡¶éƒ¨æ ‡é¢˜ -->
            <header>
                <div class="brand">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                    </svg>
                    <div>
                        <h1>ç³»ç»Ÿé…ç½®æ£€æŸ¥</h1>
                        <p>Synapse Run Environment</p>
                    </div>
                </div>
                <div class="status-badge" id="overallStatus">æ£€æŸ¥ä¸­...</div>
            </header>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="healthCheckLoading" class="dashboard-stats hidden">
                <div style="text-align: center; width: 100%; padding: 20px 0;">
                    <div class="loading"></div>
                    <span style="margin-left: 10px; color: var(--text-sub);">æ­£åœ¨æ£€æŸ¥ç³»ç»Ÿé…ç½®...</span>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="dashboard-stats hidden" id="dashboardStats">
                <div class="stat-item">
                    <span class="stat-num c-success" id="successCount">0</span>
                    <span class="stat-label">æ­£å¸¸</span>
                </div>
                <div class="stat-item">
                    <span class="stat-num c-warning" id="warningCount">0</span>
                    <span class="stat-label">è­¦å‘Š</span>
                </div>
                <div class="stat-item">
                    <span class="stat-num c-error" id="errorCount">0</span>
                    <span class="stat-label">é”™è¯¯</span>
                </div>
            </div>

            <!-- è¯¦ç»†åˆ—è¡¨ -->
            <ul class="check-list" id="checkList"></ul>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <button class="action-btn secondary" onclick="runHealthCheck()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                    é‡æ–°æ£€æŸ¥
                </button>
                <button class="action-btn primary hidden" id="importDataButton" onclick="showDataSourceSelection()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                    å¯¼ï¿½ï¿½è®­ç»ƒæ•°æ®
                </button>
                <button class="action-btn primary hidden" id="configButton" onclick="showConfigForm()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m-8-6h6m6 0h6"></path></svg>
                    å»é…ç½®
                </button>
                <button class="action-btn success hidden" id="continueButton" onclick="goToMain()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    è¿›å…¥ç³»ç»Ÿ
                </button>
            </div>
        </div>

        <!-- é…ç½®è¡¨å•è§†å›¾ -->
        <div id="configView" class="hidden">
            <header>
                <div class="brand">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6"></path><path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24"></path><path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24"></path>
                    </svg>
                    <div>
                        <h1>ç³»ç»Ÿé…ç½®</h1>
                        <p>Configuration Settings</p>
                    </div>
                </div>
            </header>

            <div id="configAlert" class="hidden"></div>

            <form id="configForm">
                <div class="config-section">
                    <div class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                        LLMé…ç½®
                    </div>
                    <div class="form-group">
                        <label for="llmApiKey">LLM API Key *</label>
                        <input type="text" id="llmApiKey" name="llm_api_key" placeholder="your_qwen_api_key_here" required>
                    </div>
                    <div class="form-group">
                        <label for="llmBaseUrl">LLM Base URL *</label>
                        <input type="text" id="llmBaseUrl" name="llm_base_url" value="https://dashscope.aliyuncs.com/compatible-mode/v1" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="defaultModel">é»˜è®¤æ¨¡å‹</label>
                            <input type="text" id="defaultModel" name="default_model" value="qwen-plus-latest">
                        </div>
                        <div class="form-group">
                            <label for="reportModel">æŠ¥å‘Šæ¨¡å‹</label>
                            <input type="text" id="reportModel" name="report_model" value="qwen3-max">
                        </div>
                    </div>
                    <div class="test-result hidden" id="llmTestResult"></div>
                    <button type="button" class="action-btn secondary" onclick="testLLMConnection()">æµ‹è¯•LLMè¿æ¥</button>
                </div>

                <div class="config-section" style="border-top: 1px solid var(--border-color);">
                    <div class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
                        æœç´¢APIé…ç½®
                    </div>
                    <div class="form-group">
                        <label for="tavilyApiKey">Tavily API Key</label>
                        <input type="text" id="tavilyApiKey" name="tavily_api_key" placeholder="your_tavily_api_key_here">
                    </div>
                    <div class="form-group">
                        <label for="bochaApiKey">Bocha API Key</label>
                        <input type="text" id="bochaApiKey" name="bocha_api_key" placeholder="your_bocha_api_key_here">
                    </div>
                </div>

                <div class="config-section" style="border-top: 1px solid var(--border-color);">
                    <div class="section-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>
                        MySQLé…ç½®
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dbHost">æ•°æ®åº“åœ°å€ *</label>
                            <input type="text" id="dbHost" name="db_host" value="localhost" required>
                        </div>
                        <div class="form-group">
                            <label for="dbPort">æ•°æ®åº“ç«¯å£ *</label>
                            <input type="number" id="dbPort" name="db_port" value="3306" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dbUser">æ•°æ®åº“ç”¨æˆ·å *</label>
                            <input type="text" id="dbUser" name="db_user" placeholder="root" required>
                        </div>
                        <div class="form-group">
                            <label for="dbPassword">æ•°æ®åº“å¯†ç  *</label>
                            <input type="password" id="dbPassword" name="db_password" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dbName">æ•°æ®åº“åç§° *</label>
                        <input type="text" id="dbName" name="db_name" value="traningData" required>
                    </div>
                    <div class="test-result hidden" id="mysqlTestResult"></div>
                    <button type="button" class="action-btn secondary" onclick="testMySQLConnection()">æµ‹è¯•MySQLè¿æ¥</button>
                    <button type="button" class="action-btn primary hidden" id="initDbButton" onclick="initDatabase()" style="margin-left: 10px;">åˆå§‹åŒ–æ•°æ®åº“</button>
                </div>

                <div class="action-buttons">
                    <button type="button" class="action-btn secondary" onclick="hideConfigForm()">è¿”å›</button>
                    <button type="submit" class="action-btn success">ä¿å­˜é…ç½®</button>
                </div>
            </form>
        </div>

        <!-- æ•°æ®æºé€‰æ‹©è§†å›¾ -->
        <div id="dataSourceView" class="hidden">
            <header>
                <div class="brand">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    <div>
                        <h1>é€‰æ‹©æ•°æ®æº</h1>
                        <p>Choose Training Data Source</p>
                    </div>
                </div>
            </header>

            <div class="config-section">
                <div class="alert" style="background: #f0f9ff; color: #0369a1; border: 1px solid #bae6fd;">
                    <strong>â„¹ï¸ æ•°æ®æºè¯´æ˜</strong><br>
                    â€¢ <strong>Keep</strong>: æ”¯æŒä¸Šä¼ Keepè¿åŠ¨APPå¯¼å‡ºçš„Excelæ–‡ä»¶<br>
                    â€¢ <strong>Garmin</strong>: è‡ªåŠ¨ä»Garmin ConnectæŠ“å–è·‘æ­¥æ•°æ®,æ— éœ€æ‰‹åŠ¨å¯¼å‡º
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                    <!-- Keepå¡ç‰‡ -->
                    <div onclick="selectDataSource('keep')" style="cursor: pointer; padding: 30px; border: 2px solid var(--border-color); border-radius: 12px; text-align: center; transition: all 0.3s;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 20px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        <h3 style="font-size: 18px; margin-bottom: 10px;">Keepè¿åŠ¨</h3>
                        <p style="font-size: 13px; color: var(--text-sub);">ä¸Šä¼ Excelæ–‡ä»¶å¯¼å…¥</p>
                    </div>

                    <!-- Garminå¡ç‰‡ -->
                    <div onclick="selectDataSource('garmin')" style="cursor: pointer; padding: 30px; border: 2px solid var(--border-color); border-radius: 12px; text-align: center; transition: all 0.3s;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 20px;">
                            <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <h3 style="font-size: 18px; margin-bottom: 10px;">Garmin Connect</h3>
                        <p style="font-size: 13px; color: var(--text-sub);">è‡ªåŠ¨æŠ“å–è®­ç»ƒæ•°æ®</p>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <button type="button" class="action-btn secondary" onclick="hideDataSourceSelection()">è¿”å›</button>
                </div>
            </div>
        </div>

        <!-- Keepæ•°æ®å¯¼å…¥è§†å›¾ -->
        <div id="importView" class="hidden">
            <header>
                <div class="brand">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    <div>
                        <h1>è®­ç»ƒæ•°æ®å¯¼å…¥</h1>
                        <p>Import Training Data</p>
                    </div>
                </div>
            </header>

            <div class="config-section">
                <div class="alert" style="background: var(--bg-warning-light); color: var(--color-warning); border: 1px solid rgba(245, 158, 11, 0.2);">
                    <strong>âš ï¸ é‡è¦æç¤º</strong><br>
                    â€¢ è¯·ç¡®ä¿å·²ä¿å­˜æ•°æ®åº“é…ç½®<br>
                    â€¢ å¯¼å…¥å°†è¦†ç›–ç°æœ‰æ‰€æœ‰è®­ç»ƒè®°å½•<br>
                    â€¢ ä»…æ”¯æŒKeepå¯¼å‡ºçš„Excelæ ¼å¼(.xlsx/.xls)
                </div>

                <div class="form-group">
                    <label for="importExcelFile">é€‰æ‹©Excelæ–‡ä»¶ *</label>
                    <input type="file" id="importExcelFile" accept=".xlsx,.xls" style="display: none;" onchange="handleImportExcelFileSelect(event)">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button type="button" class="action-btn secondary" onclick="document.getElementById('importExcelFile').click()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                            é€‰æ‹©æ–‡ä»¶
                        </button>
                        <span id="importSelectedFileName" style="color: var(--text-sub); font-size: 13px;">æœªé€‰æ‹©æ–‡ä»¶</span>
                    </div>
                </div>

                <div class="test-result hidden" id="importResult"></div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="action-btn secondary" onclick="hideImportForm()">è¿”å›</button>
                    <button type="button" class="action-btn primary hidden" id="startImportButton" onclick="startImport()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        å¼€å§‹å¯¼å…¥
                    </button>
                </div>
            </div>
        </div>

        <!-- Garminæ•°æ®å¯¼å…¥è§†å›¾ -->
        <div id="garminImportView" class="hidden">
            <header>
                <div class="brand">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2c3e50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <div>
                        <h1>Garminæ•°æ®å¯¼å…¥</h1>
                        <p>Import from Garmin Connect</p>
                    </div>
                </div>
            </header>

            <div class="config-section">
                <div class="alert" style="background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe;">
                    <strong>â„¹ï¸ Garminå¯¼å…¥è¯´æ˜</strong><br>
                    â€¢ è¾“å…¥æ‚¨çš„Garmin Connectè´¦æˆ·ä¿¡æ¯<br>
                    â€¢ ç³»ç»Ÿå°†è‡ªåŠ¨ç™»å½•å¹¶æŠ“å–æ‚¨çš„è·‘æ­¥è®­ç»ƒæ•°æ®<br>
                    â€¢ å¯¼å…¥å°†è¦†ç›–ç°æœ‰æ‰€æœ‰è®­ç»ƒè®°å½•<br>
                    â€¢ ä»…æŠ“å–è·‘æ­¥ç›¸å…³æ´»åŠ¨(running/treadmill)
                </div>

                <div class="form-group">
                    <label for="garminEmail">Garminé‚®ç®± *</label>
                    <input type="email" id="garminEmail" placeholder="your.email@example.com" style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 13px;">
                </div>

                <div class="form-group">
                    <label for="garminPassword">Garminå¯†ç  *</label>
                    <input type="password" id="garminPassword" placeholder="è¯·è¾“å…¥å¯†ç " style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 13px;">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="garminIsCN" checked style="margin-right: 8px;">
                        ä¸­å›½åŒºè´¦æˆ·
                    </label>
                    <p style="font-size: 12px; color: var(--text-sub); margin-top: 5px;">å¦‚æœæ‚¨çš„è´¦æˆ·æ˜¯é€šè¿‡Garminä¸­å›½æ³¨å†Œçš„,è¯·å‹¾é€‰æ­¤é¡¹</p>
                </div>

                <div class="test-result hidden" id="garminTestResult"></div>

                <button type="button" class="action-btn secondary" onclick="testGarminLogin()" style="margin-top: 10px;">æµ‹è¯•Garminç™»å½•</button>

                <div class="test-result hidden" id="garminImportResult" style="margin-top: 20px;"></div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="action-btn secondary" onclick="hideGarminImportForm()">è¿”å›</button>
                    <button type="button" class="action-btn primary" id="startGarminImportButton" onclick="startGarminImport()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        å¼€å§‹å¯¼å…¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let healthCheckData = null;

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œå¥åº·æ£€æŸ¥
        window.onload = function() {
            runHealthCheck();
        };

        // SVGå›¾æ ‡å®šä¹‰
        const icons = {
            success: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',
            warning: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',
            error: '<svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>'
        };

        // è¿è¡Œå¥åº·æ£€æŸ¥
        function runHealthCheck() {
            const loadingDiv = document.getElementById('healthCheckLoading');
            const statsDiv = document.getElementById('dashboardStats');
            const listDiv = document.getElementById('checkList');
            const configButton = document.getElementById('configButton');
            const continueButton = document.getElementById('continueButton');
            const statusBadge = document.getElementById('overallStatus');

            loadingDiv.classList.remove('hidden');
            statsDiv.classList.add('hidden');
            listDiv.innerHTML = '';
            configButton.classList.add('hidden');
            continueButton.classList.add('hidden');
            statusBadge.textContent = 'æ£€æŸ¥ä¸­...';
            statusBadge.className = 'status-badge';

            fetch('/api/health_check')
                .then(response => response.json())
                .then(data => {
                    loadingDiv.classList.add('hidden');

                    if (!data.success) {
                        listDiv.innerHTML = `<div class="alert error">å¥åº·æ£€æŸ¥å¤±è´¥: ${data.message}</div>`;
                        return;
                    }

                    healthCheckData = data.data;
                    displayHealthCheck(healthCheckData);

                    // æ ¹æ®çŠ¶æ€æ˜¾ç¤ºæŒ‰é’®
                    if (healthCheckData.overall_status === 'ready') {
                        continueButton.classList.remove('hidden');
                        // é…ç½®å®Œæˆåæ˜¾ç¤ºæ•°æ®å¯¼å…¥æŒ‰é’®
                        document.getElementById('importDataButton').classList.remove('hidden');
                        statusBadge.textContent = 'é…ç½®å®Œæˆ';
                        statusBadge.className = 'status-badge ready';
                    } else {
                        configButton.classList.remove('hidden');
                        if (healthCheckData.overall_status === 'partial') {
                            statusBadge.textContent = 'éƒ¨åˆ†å®Œæˆ';
                            statusBadge.className = 'status-badge partial';
                        } else {
                            statusBadge.textContent = 'éœ€è¦é…ç½®';
                            statusBadge.className = 'status-badge needs_config';
                        }
                    }
                })
                .catch(error => {
                    loadingDiv.classList.add('hidden');
                    listDiv.innerHTML = `<div class="alert error">å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}</div>`;
                });
        }

        // æ˜¾ç¤ºå¥åº·æ£€æŸ¥ç»“æœ
        function displayHealthCheck(data) {
            const statsDiv = document.getElementById('dashboardStats');
            const listDiv = document.getElementById('checkList');

            // æ˜¾ç¤ºç»Ÿè®¡
            document.getElementById('successCount').textContent = data.summary.success;
            document.getElementById('warningCount').textContent = data.summary.warning;
            document.getElementById('errorCount').textContent = data.summary.error;
            statsDiv.classList.remove('hidden');

            // æ˜¾ç¤ºè¯¦ç»†æ£€æŸ¥ç»“æœ
            let html = '';
            for (const [key, check] of Object.entries(data.checks)) {
                html += `
                    <li class="list-item">
                        <div class="icon-box ${check.status}">
                            ${icons[check.status]}
                        </div>
                        <div class="content">
                            <h3>${check.name}</h3>
                            <p>${check.message}</p>
                `;

                if (check.details) {
                    html += '<div class="error-detail">';
                    if (Array.isArray(check.details)) {
                        check.details.forEach(detail => {
                            html += `<div class="error-detail-item">â€¢ ${detail}</div>`;
                        });
                    } else {
                        html += `<div class="error-detail-item">${check.details}</div>`;
                    }
                    html += '</div>';
                }

                html += '</div></li>';
            }

            listDiv.innerHTML = html;
        }

        // æ˜¾ç¤ºé…ç½®è¡¨å•
        function showConfigForm() {
            document.getElementById('healthCheckView').classList.add('hidden');
            document.getElementById('configView').classList.remove('hidden');
            loadCurrentConfig();
            // é‡ç½®æµ‹è¯•ç»“æœçŠ¶æ€
            resetTestResults();
        }

        // éšè—é…ç½®è¡¨å•
        function hideConfigForm() {
            document.getElementById('configView').classList.add('hidden');
            document.getElementById('healthCheckView').classList.remove('hidden');
        }

        // é‡ç½®æµ‹è¯•ç»“æœçŠ¶æ€
        function resetTestResults() {
            // éšè—LLMæµ‹è¯•ç»“æœ
            const llmTestResult = document.getElementById('llmTestResult');
            llmTestResult.classList.add('hidden');
            llmTestResult.className = 'test-result hidden';
            llmTestResult.innerHTML = '';

            // éšè—MySQLæµ‹è¯•ç»“æœå’Œåˆå§‹åŒ–æŒ‰é’®
            const mysqlTestResult = document.getElementById('mysqlTestResult');
            mysqlTestResult.classList.add('hidden');
            mysqlTestResult.className = 'test-result hidden';
            mysqlTestResult.innerHTML = '';

            const initDbButton = document.getElementById('initDbButton');
            initDbButton.classList.add('hidden');

            // éšè—é…ç½®ä¿å­˜æç¤º
            const configAlert = document.getElementById('configAlert');
            configAlert.classList.add('hidden');
            configAlert.className = 'hidden';
            configAlert.innerHTML = '';
        }

        // åŠ è½½å½“å‰é…ç½®
        function loadCurrentConfig() {
            fetch('/api/get_config')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const config = data.data;
                        document.getElementById('llmApiKey').value = config.llm_api_key || '';
                        document.getElementById('llmBaseUrl').value = config.llm_base_url || '';
                        document.getElementById('defaultModel').value = config.default_model || '';
                        document.getElementById('reportModel').value = config.report_model || '';
                        document.getElementById('tavilyApiKey').value = config.tavily_api_key || '';
                        document.getElementById('bochaApiKey').value = config.bocha_api_key || '';
                        document.getElementById('dbHost').value = config.db_host || '';
                        document.getElementById('dbPort').value = config.db_port || '';
                        document.getElementById('dbUser').value = config.db_user || '';
                        document.getElementById('dbPassword').value = config.db_password || '';
                        document.getElementById('dbName').value = config.db_name || '';
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                });
        }

        // æµ‹è¯•LLMè¿æ¥
        function testLLMConnection() {
            const resultDiv = document.getElementById('llmTestResult');
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æµ‹è¯•LLMè¿æ¥...';
            resultDiv.classList.remove('hidden');

            const data = {
                api_key: document.getElementById('llmApiKey').value,
                base_url: document.getElementById('llmBaseUrl').value,
                model_name: document.getElementById('defaultModel').value
            };

            fetch('/api/test_llm_connection', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'âœ… ' + result.message;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
            });
        }

        // æµ‹è¯•MySQLè¿æ¥
        function testMySQLConnection() {
            const resultDiv = document.getElementById('mysqlTestResult');
            const initButton = document.getElementById('initDbButton');

            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æµ‹è¯•MySQLè¿æ¥...';
            resultDiv.classList.remove('hidden');
            initButton.classList.add('hidden');

            const data = {
                host: document.getElementById('dbHost').value,
                port: document.getElementById('dbPort').value,
                user: document.getElementById('dbUser').value,
                password: document.getElementById('dbPassword').value,
                database: document.getElementById('dbName').value
            };

            fetch('/api/test_mysql_connection', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    if (result.warning) {
                        resultDiv.className = 'test-result warning';
                        resultDiv.textContent = 'âš ï¸ ' + result.message;
                        initButton.classList.remove('hidden');
                    } else {
                        resultDiv.className = 'test-result success';
                        resultDiv.textContent = 'âœ… ' + result.message;
                    }
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
            });
        }

        // åˆå§‹åŒ–æ•°æ®åº“
        function initDatabase() {
            if (!confirm('ç¡®è®¤è¦åˆå§‹åŒ–æ•°æ®åº“å—?è¿™å°†åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„ã€‚')) {
                return;
            }

            const resultDiv = document.getElementById('mysqlTestResult');
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“...';

            const data = {
                host: document.getElementById('dbHost').value,
                port: document.getElementById('dbPort').value,
                user: document.getElementById('dbUser').value,
                password: document.getElementById('dbPassword').value,
                database: document.getElementById('dbName').value
            };

            fetch('/api/init_database', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'âœ… ' + result.message;
                    document.getElementById('initDbButton').classList.add('hidden');
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message;
            });
        }

        // ä¿å­˜é…ç½®
        document.getElementById('configForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const alertDiv = document.getElementById('configAlert');
            alertDiv.className = 'alert';
            alertDiv.style.margin = '0 40px 0 40px';
            alertDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨ä¿å­˜é…ç½®...';
            alertDiv.classList.remove('hidden');

            const formData = new FormData(this);
            const data = Object.fromEntries(formData);

            fetch('/api/save_config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alertDiv.className = 'alert success';
                    alertDiv.innerHTML = 'âœ… ' + result.message + '<br><small style="margin-top: 8px; display: block;">ğŸ’¡ é…ç½®å·²ä¿å­˜,ç°åœ¨å¯ä»¥åœ¨å¥åº·æ£€æŸ¥é¡µé¢è¿›è¡Œæ•°æ®å¯¼å…¥</small>';
                    setTimeout(() => {
                        hideConfigForm();
                        runHealthCheck();
                    }, 2500);
                } else {
                    alertDiv.className = 'alert error';
                    alertDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                alertDiv.className = 'alert error';
                alertDiv.textContent = 'âŒ ä¿å­˜å¤±è´¥: ' + error.message;
            });
        });

        // è¿›å…¥ä¸»ç³»ç»Ÿ
        function goToMain() {
            window.location.href = '/';
        }

        // æ˜¾ç¤ºæ•°æ®å¯¼å…¥è¡¨å•
        function showImportForm() {
            // éšè—æ‰€æœ‰å…¶ä»–è§†å›¾
            document.getElementById('healthCheckView').classList.add('hidden');
            document.getElementById('dataSourceView').classList.add('hidden');
            document.getElementById('garminImportView').classList.add('hidden');
            document.getElementById('configView').classList.add('hidden');

            // æ˜¾ç¤ºKeepå¯¼å…¥è§†å›¾
            document.getElementById('importView').classList.remove('hidden');
            resetImportForm();
        }

        // éšè—æ•°æ®å¯¼å…¥è¡¨å•
        function hideImportForm() {
            document.getElementById('importView').classList.add('hidden');
            document.getElementById('dataSourceView').classList.remove('hidden');
        }

        // é‡ç½®å¯¼å…¥è¡¨å•
        function resetImportForm() {
            const importResult = document.getElementById('importResult');
            importResult.classList.add('hidden');
            importResult.className = 'test-result hidden';
            importResult.innerHTML = '';

            const startImportButton = document.getElementById('startImportButton');
            startImportButton.classList.add('hidden');

            const importSelectedFileName = document.getElementById('importSelectedFileName');
            importSelectedFileName.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';

            const importExcelFileInput = document.getElementById('importExcelFile');
            if (importExcelFileInput) importExcelFileInput.value = '';

            selectedImportExcelFile = null;
        }

        // å¤„ç†Excelæ–‡ä»¶é€‰æ‹©
        let selectedImportExcelFile = null;

        function handleImportExcelFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            selectedImportExcelFile = file;
            document.getElementById('importSelectedFileName').textContent = file.name;
            document.getElementById('startImportButton').classList.remove('hidden');
        }

        // æ˜¾ç¤ºæ•°æ®æºé€‰æ‹©
        function showDataSourceSelection() {
            // éšè—æ‰€æœ‰å…¶ä»–è§†å›¾
            document.getElementById('healthCheckView').classList.add('hidden');
            document.getElementById('importView').classList.add('hidden');
            document.getElementById('garminImportView').classList.add('hidden');
            document.getElementById('configView').classList.add('hidden');

            // æ˜¾ç¤ºæ•°æ®æºé€‰æ‹©è§†å›¾
            document.getElementById('dataSourceView').classList.remove('hidden');
        }

        // éšè—æ•°æ®æºé€‰æ‹©
        function hideDataSourceSelection() {
            document.getElementById('dataSourceView').classList.add('hidden');
            document.getElementById('healthCheckView').classList.remove('hidden');
        }

        // é€‰æ‹©æ•°æ®æº
        function selectDataSource(source) {
            // ä¿å­˜æ•°æ®æºåˆ°é…ç½®
            fetch('/api/save_config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({training_data_source: source})
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // å…ˆéšè—æ•°æ®æºé€‰æ‹©è§†å›¾
                    document.getElementById('dataSourceView').classList.add('hidden');

                    // æ ¹æ®æ•°æ®æºè·³è½¬åˆ°ä¸åŒçš„å¯¼å…¥ç•Œé¢
                    if (source === 'keep') {
                        showImportForm();
                    } else if (source === 'garmin') {
                        showGarminImportForm();
                    }
                } else {
                    alert('ä¿å­˜æ•°æ®æºé…ç½®å¤±è´¥: ' + result.message);
                }
            })
            .catch(error => {
                alert('ä¿å­˜æ•°æ®æºé…ç½®å¤±è´¥: ' + error.message);
            });
        }

        // æ˜¾ç¤ºGarminå¯¼å…¥è¡¨å•
        function showGarminImportForm() {
            // éšè—æ‰€æœ‰å…¶ä»–è§†å›¾
            document.getElementById('healthCheckView').classList.add('hidden');
            document.getElementById('dataSourceView').classList.add('hidden');
            document.getElementById('importView').classList.add('hidden');
            document.getElementById('configView').classList.add('hidden');

            // æ˜¾ç¤ºGarminå¯¼å…¥è§†å›¾
            document.getElementById('garminImportView').classList.remove('hidden');

            // é‡ç½®Garminå¯¼å…¥è¡¨å•
            resetGarminImportForm();

            // ä»é…ç½®åŠ è½½Garminè´¦æˆ·ä¿¡æ¯
            fetch('/api/get_config')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('garminEmail').value = data.data.garmin_email || '';
                        document.getElementById('garminPassword').value = data.data.garmin_password || '';
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                });
        }

        // éšè—Garminå¯¼å…¥è¡¨å•
        function hideGarminImportForm() {
            document.getElementById('garminImportView').classList.add('hidden');
            document.getElementById('dataSourceView').classList.remove('hidden');
        }

        // é‡ç½®Garminå¯¼å…¥è¡¨å•
        function resetGarminImportForm() {
            const garminTestResult = document.getElementById('garminTestResult');
            garminTestResult.classList.add('hidden');
            garminTestResult.className = 'test-result hidden';
            garminTestResult.innerHTML = '';

            const garminImportResult = document.getElementById('garminImportResult');
            garminImportResult.classList.add('hidden');
            garminImportResult.className = 'test-result hidden';
            garminImportResult.innerHTML = '';

            const startGarminImportButton = document.getElementById('startGarminImportButton');
            startGarminImportButton.disabled = false;
        }

        // æµ‹è¯•Garminç™»å½•
        function testGarminLogin() {
            const resultDiv = document.getElementById('garminTestResult');
            const email = document.getElementById('garminEmail').value;
            const password = document.getElementById('garminPassword').value;
            const isCN = document.getElementById('garminIsCN').checked;

            if (!email || !password) {
                alert('è¯·è¾“å…¥Garminé‚®ç®±å’Œå¯†ç ');
                return;
            }

            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨æµ‹è¯•Garminç™»å½•...';
            resultDiv.classList.remove('hidden');

            fetch('/api/test_garmin_login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    email: email,
                    password: password,
                    is_cn: isCN
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = 'âœ… ' + result.message;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message;
            });
        }

        // å¼€å§‹Garminå¯¼å…¥
        function startGarminImport() {
            const email = document.getElementById('garminEmail').value;
            const password = document.getElementById('garminPassword').value;
            const isCN = document.getElementById('garminIsCN').checked;

            if (!email || !password) {
                alert('è¯·è¾“å…¥Garminé‚®ç®±å’Œå¯†ç ');
                return;
            }

            if (!confirm('ç¡®è®¤ä»Garmin Connectå¯¼å…¥æ•°æ®å—?\n\nâš ï¸ è¿™å°†è¦†ç›–ç°æœ‰çš„æ‰€æœ‰è®­ç»ƒè®°å½•!')) {
                return;
            }

            const resultDiv = document.getElementById('garminImportResult');
            const importButton = document.getElementById('startGarminImportButton');

            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨ç™»å½•Garminå¹¶æŠ“å–æ•°æ®,è¯·ç¨å€™...(å¯èƒ½éœ€è¦1-2åˆ†é’Ÿ)';
            resultDiv.classList.remove('hidden');
            importButton.disabled = true;

            fetch('/api/import_garmin_data', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    email: email,
                    password: password,
                    is_cn: isCN
                })
            })
            .then(response => response.json())
            .then(result => {
                importButton.disabled = false;

                if (result.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `âœ… ${result.message}<br><small>æˆåŠŸ: ${result.result.success}æ¡ | å¤±è´¥: ${result.result.failed}æ¡</small>`;

                    // åŒæ—¶ä¿å­˜è´¦æˆ·åˆ°é…ç½®
                    fetch('/api/save_config', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            garmin_email: email,
                            garmin_password: password
                        })
                    });
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                importButton.disabled = false;
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ å¯¼å…¥å¤±è´¥: ' + error.message;
            });
        }

        // å¼€å§‹å¯¼å…¥
        function startImport() {
            if (!selectedImportExcelFile) {
                alert('è¯·å…ˆé€‰æ‹©Excelæ–‡ä»¶');
                return;
            }

            if (!confirm('ç¡®è®¤å¯¼å…¥è®­ç»ƒæ•°æ®å—?\n\nâš ï¸ è¿™å°†è¦†ç›–ç°æœ‰çš„æ‰€æœ‰è®­ç»ƒè®°å½•!')) {
                return;
            }

            const resultDiv = document.getElementById('importResult');
            const importButton = document.getElementById('startImportButton');

            resultDiv.className = 'test-result';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨ä¸Šä¼ å¹¶å¯¼å…¥æ•°æ®,è¯·ç¨å€™...';
            resultDiv.classList.remove('hidden');
            importButton.disabled = true;

            const formData = new FormData();
            formData.append('file', selectedImportExcelFile);

            fetch('/api/upload_training_excel', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                importButton.disabled = false;

                if (result.success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `âœ… ${result.message}<br><small>æˆåŠŸ: ${result.result.success}æ¡ | å¤±è´¥: ${result.result.failed}æ¡</small>`;

                    // é‡ç½®æ–‡ä»¶é€‰æ‹©
                    selectedImportExcelFile = null;
                    document.getElementById('importExcelFile').value = '';
                    document.getElementById('importSelectedFileName').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                    importButton.classList.add('hidden');
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ' + result.message;
                }
            })
            .catch(error => {
                importButton.disabled = false;
                resultDiv.className = 'test-result error';
                resultDiv.textContent = 'âŒ ä¸Šä¼ å¤±è´¥: ' + error.message;
            });
        }
    </script>
</body>
</html>
